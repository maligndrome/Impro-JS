function populate_canvas(a){var b,c=b=1;null!=a.getAttribute("data-scale")&&""!=a.getAttribute("data-scale")&&(c=b=a.getAttribute("data-scale")/1),null!=a.getAttribute("data-scale-x")&&""!=a.getAttribute("data-scale-x")&&(b=a.getAttribute("data-scale-x")/1),null!=a.getAttribute("data-scale-y")&&""!=a.getAttribute("data-scale-y")&&(c=a.getAttribute("data-scale-y")/1);var d=a.getContext("2d"),e=new Image;e.crossOrigin="Anonymous",e.src=a.getAttribute("data-src");var f=a.getAttribute("data-type");e.onload=function(){a.width=e.width=e.width*b,a.height=e.height=e.height*c,d.drawImage(e,0,0,a.width,a.height),pix=process(a,f)}}function process(a,c){var d=a.getContext("2d"),e=d.getImageData(0,0,a.width,a.height),f=e.data;if("sepia"==c)for(var h=0,i=f.length;i>h;h+=4)r=f[h],g=f[h+1],b=f[h+2],f[h]=.393*r+.769*g+.189*b,f[h+1]=.349*r+.686*g+.168*b,f[h+2]=.272*r+.534*g+.131*b;else if("grey"==c)for(var h=0,i=f.length;i>h;h+=4)r=f[h],g=f[h+1],b=f[h+2],f[h]=(r+g+b)/3,f[h+1]=(r+g+b)/3,f[h+2]=(r+g+b)/3;else if("blur"==c){var j=convolute(f,[[.0625,.125,.0625],[.125,.25,.125],[.0625,.125,.0625]],a.height,a.width);e.data.set(j)}if("custom"==c){for(var k=a.getAttribute("data-convolution-matrix"),l=new Array,m=k.split("|"),h=0;h<m.length;h++){l[h]=new Array,_s=m[h].split(",");for(var n=0;n<_s.length;n++)l[h].push(_s[n]/1)}var j=convolute(f,l,a.height,a.width);e.data.set(j)}d.putImageData(e,0,0)}function convolute(a,b,c,d){for(var e=new Array,f=0;f<a.length;f+=4){for(var g=new Array,h=new Array,i=new Array,j=0;j<b.length;j++){g[j]=new Array,h[j]=new Array,i[j]=new Array;for(var k=0;k<b.length;k++)g[j].push(a[4*j*d+f+4*k]),h[j].push(a[4*j*d+f+1+4*k]),i[j].push(a[4*j*d+f+2+4*k])}for(var l=sumg=sumb=0,j=0;j<b.length;j++)for(var k=0;k<b.length;k++)l+=g[j][k]*b[j][k],sumg+=h[j][k]*b[j][k],sumb+=i[j][k]*b[j][k];e.push(l),e.push(sumg),e.push(sumb),e.push(255)}return console.log(a.length,e.length),e}window.onload=function(){for(a=document.getElementsByClassName("impro"),b=0;b<a.length;b++)populate_canvas(a[b])};
